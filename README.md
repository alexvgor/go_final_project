# GO_FINAL_PROJECT

## Описание проекта

Проект представляет собой простейший планировщик задач написанный на Go. Клиент-серверное взаимодействие реализовано в архитектурном стиле REST, в качестве СУБД выступает SQLite.

Сервис позволяет создавать задачи с определенными правилами повторения, а также просматривать, редактировать и удалять их.

## Список выполенных заданий со звёздочкой

- Возможность определять порт "извне" используя переменную окружения
- Возможность определять путь к файлу базы данных через переменную окружения
- Функцию, которая будет вычислять следующую дату для задачи в соответствии со следующими указанными правилами:
    - задача назначается в указанные дни **недели**
    - задача назначается в указанные дни **месяца**
- Механизм аутентификации
- Создание докер образа

## Инструкция по запуску кода локально

### Клонировать репозиторий и перейти в его директорию

```bash
$ git clone https://github.com/alexvgor/go_final_project.git ./go_final_project_folder
$ cd ./go_final_project_folder
```

### Настройка

Перед или при запуске приложения возможно передать ряд параметров влияющих на работу сервиса как переменные окружения:
+ TODO_PORT - номер порта на котором запускается веб-приложение
+ TODO_DBFILE - путь к файлу базы данных
+ LOG_LEVEL - уровень логгирования
+ TODO_SECRET - сектрет используемый для подписи ключа сессии
+ TODO_PASSWORD - пароль используемый для авторизации

> [!NOTE]
> Переменные окружения загружаются приложением из `.env` файла расположенном в корневой дирректории - пример файла `./.env_example`

```ini
TODO_PORT=3000
TODO_DBFILE=/home/user/go_final_project_folder/scheduler.db
LOG_LEVEL=DEBUG
TODO_SECRET=secret
TODO_PASSWORD=password
```

#### параметры по умолчанию:

смотри `./internal/setup/constants.go`
```go
const Port = 7540 // номер порта на котором запускается веб-приложение
const LogLevel = "INFO" // уровень логгирования DEBUG/INFO/WARN/ERROR
const Secret = "default_secret_that_should_never_exist_in_real_project" // сектрет используемый для подписи ключа сессии
```

файл базы данных создается в текущей дирректории - `./scheduler.db`

### Запуск сервера

```bash
$ go run ./cmd/app
```

> [!WARNING]
> Необходимо передать полный путь до файла базы данных для ее сохранения.

### Сборка в исполняемый файл с его последующим запуском

```bash
$ go build -o ./go_final_project ./cmd/app
```
```bash
$ go_final_project
```

### Взаимодействие через веб-интерфейс 

Открыть в любом браузере `http://localhost:[порт_указанный_при_настройке]` 

По умолчанию используется [7540](http://localhost:7540) порт


## Инструкция по запуску тестов

Некоторые параметры тестирования задаются в файле `./tests/settings.go`.

Используемые параметры:
```go
var Port = 7540 // не имеет силы при использовании переменной окружения TODO_PORT
var DBFile = "../scheduler.db" // не имеет силы при использовании переменной окружения TODO_DBFILE
var FullNextDate = true
var Search = true
var Token = `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJoYXNoIjoiJDJhJDA4JGNGaUFyM1ZyNEM2QWVCdmlLYXAwcU9wbnhKU2VEUlpMcUlTZHhGQjhQNWxQTUZJbjZIUDhTIn0.kqlnjLpfJJoeAVJ7yxPDwr88vF7tZcNUAuMjdkSyPhI` // токен доступа полученный для пароля "password"
```

Команда для очистки от закэшированных данных тестирования

```bash
$ go clean -testcache
```
Команда для запуска тестов
```bash
$ go test ./tests
```


## Инструкция по сборке и запуску проекта через докер

[Настройка параметров](#настройка)

### Сборка и запуск контейнера из текущей дирректории с использованием docker-compose

```bash
$ docker compose up
```

При сборке контейнера монтируется папка `./DB` в которой находится файл созданной базы данных. Для запуска тестов с использованием данного файла может потребоваться изменение прав доступа ко всей папке.


### Сборка и запуск контейнера из текущей дирректории с использованием docker

```bash
$ docker build --tag go_final_project .
```
```bash
$ docker run -e "ИМЯ_ПЕРЕМЕННОЙ=ЗНАЧЕНИЕ_ПЕРЕМЕННОЙ" -p ПОРТ:ПОРТ -d go_final_project
```

пример

```bash
$ docker run -e "TODO_PORT=7540" -p 7540:7540 -d go_final_project
```

## Файлы

```md
go_final_project_folder
│
├── cmd
│   └── app    - содержит файлы - "точки входа" приложения
│        └── main.go
│
├── internal    - содержит файлы с бизнес-логикой приложения
│   │
│   ├── database
│   │     └── database.go    - файл описывает взаимодействие с базой данных
│   │
│   ├── handlers    - файлы обработчики
│   │     ├── unrouted.go    - скрипты обработки неотловленных запросов
│   │     ├── auth.go    - обработка запросов авторизации
│   │     ├── next_date.go    - скрипты обработки запроса переноса задач
│   │     ├── task.go    - скрипты обработки операций с задачей
│   │     ├── tasks.go    - скрипты обработки операций с задачами
│   │     └── common.go    - скрипты общие для обработчиков
│   │
│   ├── middleware    - файлы промежуточного ПО
│   │     └── session.go    - скрипты обработки сессии
│   │
│   ├── models    - файлы описывающие взаимодействие
│   │     ├── task.go    - файл описывающий запросы задач
│   │     └── common.go    - файл описывающий общие запросы
│   │
│   ├── routes    - файлы описывающие маршрутизацию
│   │     ├── public.go    - публично доступные api
│   │     ├── private.go    - api требующие авторизации
│   │     ├── fileserver.go    - статичные файлы
│   │     ├── nextdate.go    - перенос задач
│   │     ├── signin.go    - авторизация
│   │     ├── task.go    - запрос операций с задачей
│   │     ├── tasks.go    - запрос операций с задачами
│   │     └── unrouted.go    - неотловленные запросы
│   │
│   ├── setup    - файлы описывающие настройку
│   │     ├── constants.go    - параметры приложения по умолчанию
│   │     ├── env.go    - скрипты обработки файла переменных окружения
│   │     ├── log.go    - скрипты настройки логгера
│   │     └── setup.go    - скрипты настройки приложения
│   │
│   └── taskmanager    - файлы описывающие работу с задачами
│         ├── next_date.go    - скрипты определения переноса задач
│         └── taskmanager.go    - скрипты операций с задачами
│
├── tests      - тесты для проверки API, которое должно быть реализовано в веб-сервере
│   ├── addtask_4_test.go
│   ├── app_1_test.go
│   ├── db_2_test.go
│   ├── nextdate_3_test.go
│   ├── task_6_test.go
│   ├── task_7_test.go
│   ├── tasks_5_test.go
│   └── settings.go    - файл параметров для тестирования
│
├── web    - статичные файлы
│   ├── css    - файлы стилей
│   │    └── ...
│   ├── js    - файлы js скриптов
│   │    └── ...
│   ├── index.html    - файл главной страницы приложения
│   ├── login.html    - файл страницы авторизации
│   └── favicon.ico    - иконка страницы
│
├── Dockerfile     - файл настройки docker контейнера
├── docker-compose.yaml     - файл настройки docker-compose
├── .env     - конфигурационный файл переменных окружения
│
├── go.mod
├── go.sum
│
└── README.md
```